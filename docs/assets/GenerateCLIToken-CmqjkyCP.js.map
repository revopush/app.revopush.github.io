{"version":3,"file":"GenerateCLIToken-CmqjkyCP.js","sources":["../../src/screens/Login/GenerateCLIToken.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { App, Result, Card, Flex, Layout, Typography, Button } from 'antd';\nimport { useNavigate, useSearchParams } from 'react-router';\nimport { useMutation } from '@tanstack/react-query';\nimport { AxiosError, AxiosResponse } from 'axios';\nimport dayjs from 'dayjs';\nimport duration from 'dayjs/plugin/duration';\nimport { CopyOutlined } from '@ant-design/icons';\n\nimport ContentFooter from '../../components/Footer/Footer.tsx';\nimport { addAccessKey } from '../../api/client.ts';\n\ndayjs.extend(duration);\n\nconst { Content } = Layout;\nconst { Title, Paragraph, Text } = Typography;\n\nconst GenerateCLIToken = () => {\n  const [searchParams] = useSearchParams();\n  const navigate = useNavigate();\n  const { message } = App.useApp();\n  const [key, setKey] = useState(null);\n\n  const { mutate, isPending, isError, error } = useMutation<\n    AxiosResponse,\n    AxiosError,\n    { friendlyName: string; ttl: number }\n  >({\n    mutationFn: addAccessKey,\n    onSuccess: (response) => {\n      if (response?.data?.accessKey) {\n        setKey(response?.data?.accessKey?.name);\n      }\n    },\n    onError: (error) => {\n      if (error.status !== 409) {\n        message.open({\n          type: 'error',\n          content:\n            (error?.response?.data as string) ||\n            \"Couldn't create new access key\",\n        });\n      }\n    },\n  });\n\n  useEffect(() => {\n    const hostname = searchParams.get('hostname');\n    if (hostname) {\n      const milliseconds = dayjs.duration(60, 'days').asMilliseconds();\n      mutate({\n        friendlyName: hostname,\n        ttl: milliseconds,\n      });\n    }\n  }, [mutate, searchParams]);\n\n  return (\n    <Layout>\n      <Content>\n        <Flex\n          justify=\"center\"\n          align=\"center\"\n          style={{ height: '100vh' }}\n          vertical\n        >\n          <Card loading={isPending}>\n            {isError || !searchParams.get('hostname') ? (\n              <Result\n                status=\"error\"\n                title={\n                  error?.status === 409\n                    ? 'The access key already exists'\n                    : 'Authentication Failed'\n                }\n                subTitle={\n                  error?.status === 409\n                    ? 'Got to Settings -> Add new key to release a new key.'\n                    : 'Try again or contact our support: support@revopush.org'\n                }\n                extra={\n                  error?.status === 409\n                    ? [\n                        <Button\n                          onClick={() => navigate('/settings')}\n                          type=\"primary\"\n                          key=\"console\"\n                        >\n                          Go to Settings\n                        </Button>,\n                      ]\n                    : []\n                }\n              />\n            ) : (\n              <Flex justify=\"center\" align=\"start\" vertical>\n                <Title level={2} style={{ marginBottom: 0, marginTop: 0 }}>\n                  Authentication succeeded\n                </Title>\n                <br />\n                <Text>\n                  Please copy and paste this token to the command window:\n                </Text>\n                <br />\n                <Paragraph\n                  code\n                  copyable={{\n                    icon: (\n                      <CopyOutlined style={{ fontSize: 18, marginLeft: 10 }} />\n                    ),\n                  }}\n                  style={{ fontSize: 22 }}\n                >\n                  {key}\n                </Paragraph>\n                <Text>After doing so, please close this browser tab.</Text>\n              </Flex>\n            )}\n          </Card>\n          <ContentFooter />\n        </Flex>\n      </Content>\n    </Layout>\n  );\n};\n\nexport default GenerateCLIToken;\n"],"names":["dayjs","duration","Content","Layout","Title","Paragraph","Text","Typography","GenerateCLIToken","searchParams","useSearchParams","navigate","useNavigate","message","App","key","setKey","useState","mutate","isPending","isError","error","useMutation","addAccessKey","response","_a","_c","_b","useEffect","hostname","milliseconds","jsx","jsxs","Flex","Card","Result","Button","CopyOutlined","ContentFooter"],"mappings":"ioBAYAA,EAAM,OAAOC,CAAQ,EAErB,KAAM,CAAE,QAAAC,CAAY,EAAAC,EACd,CAAE,MAAAC,EAAO,UAAAC,EAAW,KAAAC,CAAA,EAASC,EAE7BC,EAAmB,IAAM,CACvB,KAAA,CAACC,CAAY,EAAIC,EAAgB,EACjCC,EAAWC,EAAY,EACvB,CAAE,QAAAC,CAAA,EAAYC,EAAI,OAAO,EACzB,CAACC,EAAKC,CAAM,EAAIC,EAAAA,SAAS,IAAI,EAE7B,CAAE,OAAAC,EAAQ,UAAAC,EAAW,QAAAC,EAAS,MAAAC,CAAA,EAAUC,EAI5C,CACA,WAAYC,EACZ,UAAYC,GAAa,YACnBC,EAAAD,GAAA,YAAAA,EAAU,OAAV,MAAAC,EAAgB,WACXT,GAAAU,GAAAC,EAAAH,GAAA,YAAAA,EAAU,OAAV,YAAAG,EAAgB,YAAhB,YAAAD,EAA2B,IAAI,CAE1C,EACA,QAAUL,GAAU,OACdA,EAAM,SAAW,KACnBR,EAAQ,KAAK,CACX,KAAM,QACN,UACGQ,EAAAA,GAAAA,YAAAA,EAAO,WAAPA,YAAAA,EAAiB,OAClB,gCAAA,CACH,CACH,CACF,CACD,EAEDO,OAAAA,EAAAA,UAAU,IAAM,CACR,MAAAC,EAAWpB,EAAa,IAAI,UAAU,EAC5C,GAAIoB,EAAU,CACZ,MAAMC,EAAe9B,EAAM,SAAS,GAAI,MAAM,EAAE,eAAe,EACxDkB,EAAA,CACL,aAAcW,EACd,IAAKC,CAAA,CACN,CAAA,CACH,EACC,CAACZ,EAAQT,CAAY,CAAC,EAGvBsB,EAAAA,IAAC5B,EACC,CAAA,SAAA4B,EAAAA,IAAC7B,EACC,CAAA,SAAA8B,EAAA,KAACC,EAAA,CACC,QAAQ,SACR,MAAM,SACN,MAAO,CAAE,OAAQ,OAAQ,EACzB,SAAQ,GAER,SAAA,CAACF,EAAAA,IAAAG,EAAA,CAAK,QAASf,EACZ,SAAAC,GAAW,CAACX,EAAa,IAAI,UAAU,EACtCsB,EAAA,IAACI,EAAA,CACC,OAAO,QACP,OACEd,GAAA,YAAAA,EAAO,UAAW,IACd,gCACA,wBAEN,UACEA,GAAA,YAAAA,EAAO,UAAW,IACd,uDACA,yDAEN,OACEA,GAAA,YAAAA,EAAO,UAAW,IACd,CACEU,EAAA,IAACK,EAAA,CACC,QAAS,IAAMzB,EAAS,WAAW,EACnC,KAAK,UAEN,SAAA,gBAAA,EADK,SAAA,CAGN,EAEF,CAAA,CAAC,CAAA,SAIRsB,EAAK,CAAA,QAAQ,SAAS,MAAM,QAAQ,SAAQ,GAC3C,SAAA,CAACF,EAAAA,IAAA3B,EAAA,CAAM,MAAO,EAAG,MAAO,CAAE,aAAc,EAAG,UAAW,CAAE,EAAG,SAE3D,0BAAA,CAAA,QACC,KAAG,EAAA,EACJ2B,EAAAA,IAACzB,GAAK,SAEN,yDAAA,CAAA,QACC,KAAG,EAAA,EACJyB,EAAA,IAAC1B,EAAA,CACC,KAAI,GACJ,SAAU,CACR,WACGgC,EAAa,CAAA,MAAO,CAAE,SAAU,GAAI,WAAY,GAAM,CAAA,CAE3D,EACA,MAAO,CAAE,SAAU,EAAG,EAErB,SAAAtB,CAAA,CACH,EACAgB,EAAAA,IAACzB,GAAK,SAA8C,gDAAA,CAAA,CAAA,CAAA,CACtD,CAEJ,CAAA,QACCgC,EAAc,CAAA,CAAA,CAAA,CAAA,GAEnB,CACF,CAAA,CAEJ"}