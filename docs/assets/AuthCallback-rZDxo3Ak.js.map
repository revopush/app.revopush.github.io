{"version":3,"file":"AuthCallback-rZDxo3Ak.js","sources":["../../src/screens/Login/AuthCallback.tsx"],"sourcesContent":["import { type FC, useEffect, useRef } from 'react';\nimport { useNavigate, useParams, useSearchParams } from 'react-router';\nimport { callbackAuthProvider } from '../../api/client.ts';\nimport { Flex, Layout, Spin } from 'antd';\nimport ReactGA from 'react-ga4';\n\nconst { Content } = Layout;\n\nconst AuthCallback: FC = () => {\n  const navigate = useNavigate();\n  const { provider } = useParams();\n  const [searchParams] = useSearchParams();\n\n  const hasEffectRun = useRef(false);\n\n  useEffect(() => {\n    const handlePopState = () => {\n      navigate('/');\n    };\n\n    window.addEventListener('popstate', handlePopState);\n\n    return () => {\n      window.removeEventListener('popstate', handlePopState);\n    };\n  }, [navigate]);\n\n  useEffect(() => {\n    if (!hasEffectRun.current) {\n      const queryParams = Object.fromEntries(searchParams.entries());\n      const queryString = new URLSearchParams(queryParams).toString();\n      hasEffectRun.current = true;\n\n      ReactGA.send({\n        hitType: 'authcallabck',\n        page: `Provider: ${provider} Query: ${queryString}`,\n      });\n\n      callbackAuthProvider(queryString, provider)\n        .then((response) => {\n          navigate(response?.originalUrl ?? '/');\n          ReactGA.event({\n            category: 'Auth',\n            action: `Auth done: ${response?.originalUrl ?? '/'}`,\n          });\n        })\n        .catch((error) => {\n          if (error?.status === 409) {\n            navigate('/login?accountExists=true');\n          }\n          if (error?.status === 403) {\n            navigate('/register?accountEmpty=true');\n          }\n          ReactGA.event({\n            category: 'Auth',\n            action: `Auth callback error: ${error?.status}`,\n          });\n        });\n    }\n  }, [navigate, provider, searchParams]);\n\n  return (\n    <Layout>\n      <Content>\n        <Flex\n          justify=\"center\"\n          align=\"center\"\n          style={{ height: '100vh' }}\n          vertical\n        >\n          <Spin size=\"large\" />\n        </Flex>\n      </Content>\n    </Layout>\n  );\n};\n\nexport default AuthCallback;\n"],"names":["Content","Layout","AuthCallback","navigate","useNavigate","provider","useParams","searchParams","useSearchParams","hasEffectRun","useRef","useEffect","handlePopState","queryParams","queryString","ReactGA","callbackAuthProvider","response","error","jsx","Flex","Spin"],"mappings":"qcAMA,KAAM,CAAE,QAAAA,CAAY,EAAAC,EAEdC,EAAmB,IAAM,CAC7B,MAAMC,EAAWC,EAAY,EACvB,CAAE,SAAAC,CAAS,EAAIC,EAAU,EACzB,CAACC,CAAY,EAAIC,EAAgB,EAEjCC,EAAeC,SAAO,EAAK,EAEjCC,OAAAA,EAAAA,UAAU,IAAM,CACd,MAAMC,EAAiB,IAAM,CAC3BT,EAAS,GAAG,CACd,EAEO,cAAA,iBAAiB,WAAYS,CAAc,EAE3C,IAAM,CACJ,OAAA,oBAAoB,WAAYA,CAAc,CACvD,CAAA,EACC,CAACT,CAAQ,CAAC,EAEbQ,EAAAA,UAAU,IAAM,CACV,GAAA,CAACF,EAAa,QAAS,CACzB,MAAMI,EAAc,OAAO,YAAYN,EAAa,SAAS,EACvDO,EAAc,IAAI,gBAAgBD,CAAW,EAAE,SAAS,EAC9DJ,EAAa,QAAU,GAEvBM,EAAQ,KAAK,CACX,QAAS,eACT,KAAM,aAAaV,CAAQ,WAAWS,CAAW,EAAA,CAClD,EAEDE,EAAqBF,EAAaT,CAAQ,EACvC,KAAMY,GAAa,CACTd,GAAAc,GAAA,YAAAA,EAAU,cAAe,GAAG,EACrCF,EAAQ,MAAM,CACZ,SAAU,OACV,OAAQ,eAAcE,GAAA,YAAAA,EAAU,cAAe,GAAG,EAAA,CACnD,CAAA,CACF,EACA,MAAOC,GAAU,EACZA,GAAA,YAAAA,EAAO,UAAW,KACpBf,EAAS,2BAA2B,GAElCe,GAAA,YAAAA,EAAO,UAAW,KACpBf,EAAS,6BAA6B,EAExCY,EAAQ,MAAM,CACZ,SAAU,OACV,OAAQ,wBAAwBG,GAAA,YAAAA,EAAO,MAAM,EAAA,CAC9C,CAAA,CACF,CAAA,CAEJ,EAAA,CAACf,EAAUE,EAAUE,CAAY,CAAC,EAGnCY,EAAAA,IAAClB,EACC,CAAA,SAAAkB,EAAAA,IAACnB,EACC,CAAA,SAAAmB,EAAA,IAACC,EAAA,CACC,QAAQ,SACR,MAAM,SACN,MAAO,CAAE,OAAQ,OAAQ,EACzB,SAAQ,GAER,SAAAD,EAAAA,IAACE,EAAK,CAAA,KAAK,OAAQ,CAAA,CAAA,GAEvB,CACF,CAAA,CAEJ"}