{"version":3,"file":"GenerateCLIToken-C52DD2HD.js","sources":["../../src/screens/Login/GenerateCLIToken.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { App, Result, Card, Flex, Layout, Typography } from 'antd';\nimport { useSearchParams } from 'react-router';\nimport { useMutation } from '@tanstack/react-query';\nimport { AxiosError, AxiosResponse } from 'axios';\nimport dayjs from 'dayjs';\nimport duration from 'dayjs/plugin/duration';\nimport { CopyOutlined } from '@ant-design/icons';\n\nimport ContentFooter from '../../components/Footer/Footer.tsx';\nimport { addAccessKey } from '../../api/client.ts';\n\ndayjs.extend(duration);\n\nconst { Content } = Layout;\nconst { Title, Paragraph, Text } = Typography;\n\nconst GenerateCLIToken = () => {\n  const [searchParams] = useSearchParams();\n  const { message } = App.useApp();\n  const [key, setKey] = useState(null);\n\n  const { mutate, isPending, isError } = useMutation<\n    AxiosResponse,\n    AxiosError,\n    { friendlyName: string; ttl: number }\n  >({\n    mutationFn: addAccessKey,\n    onSuccess: (response) => {\n      if (response?.data?.accessKey) {\n        setKey(response?.data?.accessKey?.name);\n      }\n    },\n    onError: (error) => {\n      message.open({\n        type: 'error',\n        content:\n          (error?.response?.data as string) || \"Couldn't create new access key\",\n      });\n    },\n  });\n\n  useEffect(() => {\n    const hostname = searchParams.get('hostname');\n    if (hostname) {\n      const milliseconds = dayjs.duration(60, 'days').asMilliseconds();\n      mutate({\n        friendlyName: hostname,\n        ttl: milliseconds,\n      });\n    }\n  }, [mutate, searchParams]);\n\n  return (\n    <Layout>\n      <Content>\n        <Flex\n          justify=\"center\"\n          align=\"center\"\n          style={{ height: '100vh' }}\n          vertical\n        >\n          <Card loading={isPending}>\n            {isError || !searchParams.get('hostname') ? (\n              <Result\n                status=\"error\"\n                title=\"Authentication Failed\"\n                subTitle=\"Try again or contact our support: support@revopush.org\"\n              />\n            ) : (\n              <Flex justify=\"center\" align=\"start\" vertical>\n                <Title level={2} style={{ marginBottom: 0, marginTop: 0 }}>\n                  Authentication succeeded\n                </Title>\n                <br />\n                <Text>\n                  Please copy and paste this token to the command window:\n                </Text>\n                <br />\n                <Paragraph\n                  code\n                  copyable={{\n                    icon: (\n                      <CopyOutlined style={{ fontSize: 18, marginLeft: 10 }} />\n                    ),\n                  }}\n                  style={{ fontSize: 22 }}\n                >\n                  {key}\n                </Paragraph>\n                <Text>After doing so, please close this browser tab.</Text>\n              </Flex>\n            )}\n          </Card>\n          <ContentFooter />\n        </Flex>\n      </Content>\n    </Layout>\n  );\n};\n\nexport default GenerateCLIToken;\n"],"names":["dayjs","duration","Content","Layout","Title","Paragraph","Text","Typography","GenerateCLIToken","searchParams","useSearchParams","message","App","key","setKey","useState","mutate","isPending","isError","useMutation","addAccessKey","response","_a","_c","_b","error","useEffect","hostname","milliseconds","jsx","jsxs","Flex","Card","Result","CopyOutlined","ContentFooter"],"mappings":"wnBAYAA,EAAM,OAAOC,CAAQ,EAErB,KAAM,CAAE,QAAAC,CAAY,EAAAC,EACd,CAAE,MAAAC,EAAO,UAAAC,EAAW,KAAAC,CAAA,EAASC,EAE7BC,EAAmB,IAAM,CACvB,KAAA,CAACC,CAAY,EAAIC,EAAgB,EACjC,CAAE,QAAAC,CAAA,EAAYC,EAAI,OAAO,EACzB,CAACC,EAAKC,CAAM,EAAIC,EAAAA,SAAS,IAAI,EAE7B,CAAE,OAAAC,EAAQ,UAAAC,EAAW,QAAAC,CAAA,EAAYC,EAIrC,CACA,WAAYC,EACZ,UAAYC,GAAa,YACnBC,EAAAD,GAAA,YAAAA,EAAU,OAAV,MAAAC,EAAgB,WACXR,GAAAS,GAAAC,EAAAH,GAAA,YAAAA,EAAU,OAAV,YAAAG,EAAgB,YAAhB,YAAAD,EAA2B,IAAI,CAE1C,EACA,QAAUE,GAAU,OAClBd,EAAQ,KAAK,CACX,KAAM,QACN,UACGW,EAAAG,GAAA,YAAAA,EAAO,WAAP,YAAAH,EAAiB,OAAmB,gCAAA,CACxC,CAAA,CACH,CACD,EAEDI,OAAAA,EAAAA,UAAU,IAAM,CACR,MAAAC,EAAWlB,EAAa,IAAI,UAAU,EAC5C,GAAIkB,EAAU,CACZ,MAAMC,EAAe5B,EAAM,SAAS,GAAI,MAAM,EAAE,eAAe,EACxDgB,EAAA,CACL,aAAcW,EACd,IAAKC,CAAA,CACN,CAAA,CACH,EACC,CAACZ,EAAQP,CAAY,CAAC,EAGvBoB,EAAAA,IAAC1B,EACC,CAAA,SAAA0B,EAAAA,IAAC3B,EACC,CAAA,SAAA4B,EAAA,KAACC,EAAA,CACC,QAAQ,SACR,MAAM,SACN,MAAO,CAAE,OAAQ,OAAQ,EACzB,SAAQ,GAER,SAAA,CAACF,EAAAA,IAAAG,EAAA,CAAK,QAASf,EACZ,SAAAC,GAAW,CAACT,EAAa,IAAI,UAAU,EACtCoB,EAAA,IAACI,EAAA,CACC,OAAO,QACP,MAAM,wBACN,SAAS,wDAAA,CAAA,SAGVF,EAAK,CAAA,QAAQ,SAAS,MAAM,QAAQ,SAAQ,GAC3C,SAAA,CAACF,EAAAA,IAAAzB,EAAA,CAAM,MAAO,EAAG,MAAO,CAAE,aAAc,EAAG,UAAW,CAAE,EAAG,SAE3D,0BAAA,CAAA,QACC,KAAG,EAAA,EACJyB,EAAAA,IAACvB,GAAK,SAEN,yDAAA,CAAA,QACC,KAAG,EAAA,EACJuB,EAAA,IAACxB,EAAA,CACC,KAAI,GACJ,SAAU,CACR,WACG6B,EAAa,CAAA,MAAO,CAAE,SAAU,GAAI,WAAY,GAAM,CAAA,CAE3D,EACA,MAAO,CAAE,SAAU,EAAG,EAErB,SAAArB,CAAA,CACH,EACAgB,EAAAA,IAACvB,GAAK,SAA8C,gDAAA,CAAA,CAAA,CAAA,CACtD,CAEJ,CAAA,QACC6B,EAAc,CAAA,CAAA,CAAA,CAAA,GAEnB,CACF,CAAA,CAEJ"}