import{cF as j,f as b,o as T,r,cE as k,j as e,L as f,F as u,i as w,B as v,cG as A,l as I,T as C,aZ as E}from"./index-bdgtsci_.js";import{u as S}from"./useMutation-3a255Gp2.js";import{d as h}from"./dayjs.min-CNh9wlay.js";import{d as F}from"./duration-B2zdq4cJ.js";import{R as L}from"./index-Cj_CVYQ7.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},o=new s.Error().stack;o&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[o]="e9407a6d-9676-4ed2-8c33-ce8b618a87a2",s._sentryDebugIdIdentifier="sentry-dbid-e9407a6d-9676-4ed2-8c33-ce8b618a87a2")}catch{}})();h.extend(F);const{Content:G}=f,{Title:P,Paragraph:R,Text:y}=C,M=()=>{const[s]=j(),o=b(),{message:i}=T.useApp(),[g,m]=r.useState(null),{mutate:c,isPending:p,isError:x,error:a}=S({mutationFn:E,onSuccess:t=>{var n,d,l;(n=t==null?void 0:t.data)!=null&&n.accessKey&&m((l=(d=t==null?void 0:t.data)==null?void 0:d.accessKey)==null?void 0:l.name)},onError:t=>{var n;t.status!==409&&i.open({type:"error",content:((n=t==null?void 0:t.response)==null?void 0:n.data)||"Couldn't create new access key"})}});return r.useEffect(()=>{const t=s.get("hostname");if(t){k.event({category:"Auth",action:`CLI Token requested ${t}`,label:"CLI Token"});const n=h.duration(60,"days").asMilliseconds();c({friendlyName:t,ttl:n})}},[c,s]),e.jsx(f,{children:e.jsx(G,{children:e.jsxs(u,{justify:"center",align:"center",style:{height:"100vh"},vertical:!0,children:[e.jsx(w,{loading:p,children:x||!s.get("hostname")?e.jsx(L,{status:"error",title:(a==null?void 0:a.status)===409?"The access key already exists":"Authentication Failed",subTitle:(a==null?void 0:a.status)===409?"Got to Settings -> Add new key to release a new key.":"Try again or contact our support: support@revopush.org",extra:(a==null?void 0:a.status)===409?[e.jsx(v,{onClick:()=>o("/settings"),type:"primary",children:"Go to Settings"},"console")]:[]}):e.jsxs(u,{justify:"center",align:"start",vertical:!0,children:[e.jsx(P,{level:2,style:{marginBottom:0,marginTop:0},children:"Authentication succeeded"}),e.jsx("br",{}),e.jsx(y,{children:"Please copy and paste this token to the command window:"}),e.jsx("br",{}),e.jsx(R,{code:!0,copyable:{icon:e.jsx(A,{style:{fontSize:18,marginLeft:10}})},style:{fontSize:22},children:g}),e.jsx(y,{children:"After doing so, please close this browser tab."})]})}),e.jsx(I,{})]})})})};export{M as default};
//# sourceMappingURL=GenerateCLIToken-NXgmeVYL.js.map
